(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5c50e4b8"],{"2a49":function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"column-view"},[i("van-nav-bar",{attrs:{title:"发布任务","right-text":"说明","left-text":"返回",fixed:"","left-arrow":""},on:{"click-left":e.onNavBarLeftPressed,"click-right":e.onNavBarRightPressed}}),i("div",{staticClass:"under-nav main-height overflow-auto"},[i("section",[i("van-cell-group",{attrs:{title:"任务详情"}},[i("van-cell",{attrs:{title:"任务类型",value:e.missionTypeTitles[e.missionTypeIndex],"is-link":""},on:{click:function(t){e.showMissionTypePicker=!0}}}),i("van-cell",{attrs:{title:"支持设备",value:e.platformNames[e.supportPlatformIndex],"is-link":""},on:{click:function(t){e.showPlatformTypePicker=!0}}}),i("van-field",{attrs:{label:"标题",placeholder:"项目名称+核心要求，12字以内"},model:{value:e.missionTitle,callback:function(t){e.missionTitle=t},expression:"missionTitle"}}),i("van-cell",{attrs:{title:"截止时间",value:e.deadLineTimeString,"is-link":""},on:{click:e.onDeadLinePickClick}}),i("van-field",{attrs:{label:"出价",placeholder:e.pricePlaceholder,type:"number"},model:{value:e.price,callback:function(t){e.price=t},expression:"price"}}),i("van-field",{attrs:{label:"数量",placeholder:e.countPlaceholder,type:"number"},model:{value:e.count,callback:function(t){e.count=t},expression:"count"}}),i("van-cell",{attrs:{title:"合计",value:e.totalPrice,label:e.feeText}})],1),i("van-cell-group",{attrs:{title:"审核内容"}},[i("van-collapse",{attrs:{accordion:""},model:{value:e.collapseActiveName,callback:function(t){e.collapseActiveName=t},expression:"collapseActiveName"}},[i("van-collapse-item",{attrs:{title:"审核图样",label:"上传验证图样例，最多可上传"+e.sampleImgCount+"张",name:"1"}},[i("div",{staticClass:"sample-img"},[e._l(e.sampleImgArray,function(t,n){return i("div",{key:n,staticClass:"sample-img-card",on:{click:function(t){return t.stopPropagation(),e.onSampleItemClick(n)}}},[i("img-card",{attrs:{"add-size":50,"img-content":t.content},on:{onReadImg:e.onSampleReadImg,onDeleteImg:function(t){return e.onSampleDeleteImg(n)}}})],1)}),i("div",{directives:[{name:"show",rawName:"v-show",value:e.sampleImgArray.length<e.sampleImgCount,expression:"sampleImgArray.length < sampleImgCount"}],staticClass:"sample-img-card"},[i("img-card",{attrs:{"add-size":50},on:{onReadImg:e.onSampleReadImg}})],1)],2)]),i("van-collapse-item",{attrs:{title:"操作说明",label:"简单易懂的操作指南将大幅度提高接单效率",name:"2"}},[i("van-steps",{attrs:{direction:"vertical",active:-1}},e._l(e.explainSteps,function(t,n){return i("van-step",{key:n},[i("div",{staticClass:"flex-row flex-align-center"},[i("van-icon",{staticClass:"order-icon",attrs:{info:n+1}}),i("div",{staticClass:"explain-img-card",on:{click:function(t){return e.onExplainItemClick(n)}}},[i("img-card",{attrs:{"add-size":40,"img-content":t.img?t.img.content:null,name:n+"","delete-size":25},on:{onReadImg:e.onExplainReadImg,onDeleteImg:function(t){return e.onExplainDeleteImg(n)}}})],1),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.text,expression:"item.text"}],staticClass:"text-explain-input",attrs:{placeholder:"请输入步骤说明"},domProps:{value:t.text},on:{input:function(i){i.target.composing||e.$set(t,"text",i.target.value)}}}),i("van-icon",{staticClass:"explain-delete-all",attrs:{name:"clear",size:e.px2rem(30)+"rem",color:"#969799"},on:{click:function(t){return t.stopPropagation(),e.onExplainDelete(n)}}})],1)])}),1),i("div",{staticClass:"flex-row flex-justify-center"},[i("button",{staticClass:"add-explain-button",on:{click:e.onAddExplainStepPressed}},[e._v("添加步骤")])])],1)],1),i("van-field",{attrs:{label:"链接",placeholder:"请输入准确链接地址，如无可不填"},model:{value:e.missionUrl,callback:function(t){e.missionUrl=t},expression:"missionUrl"}}),i("van-field",{attrs:{label:"文字验证",type:"textarea",placeholder:"如需接单者提供文字信息，请在此输入，如不需要可不填，500字以内",autosize:""},model:{value:e.textVerify,callback:function(t){e.textVerify=t},expression:"textVerify"}}),i("van-field",{attrs:{label:"备注",type:"textarea",placeholder:"200字以内",autosize:""},model:{value:e.remarks,callback:function(t){e.remarks=t},expression:"remarks"}})],1)],1),i("div",{staticClass:"submit"},[i("button",{staticClass:"left-button",on:{click:e.onNavBarLeftPressed}},[e._v("取  消")]),i("button",{on:{click:e.onCreateMissionButtonPressed}},[e._v("提  交")])])]),i("van-popup",{attrs:{position:"bottom",overlay:!0},model:{value:e.showMissionTypePicker,callback:function(t){e.showMissionTypePicker=t},expression:"showMissionTypePicker"}},[i("van-picker",{attrs:{columns:e.missionTypeTitles,"show-toolbar":"",title:"请选择任务类型"},on:{confirm:e.onMissionTypePickConfirm,cancel:function(t){e.showMissionTypePicker=!1}}})],1),i("van-popup",{attrs:{position:"bottom",overlay:!0},model:{value:e.showPlatformTypePicker,callback:function(t){e.showPlatformTypePicker=t},expression:"showPlatformTypePicker"}},[i("van-picker",{attrs:{columns:e.platformNames,"show-toolbar":"",title:"请选择支持设备类型"},on:{confirm:e.onPlatformTypePickConfirm,cancel:function(t){e.showPlatformTypePicker=!1}}})],1),i("van-popup",{attrs:{position:"bottom",overlay:!0},model:{value:e.showMissionDeadLineTimePicker,callback:function(t){e.showMissionDeadLineTimePicker=t},expression:"showMissionDeadLineTimePicker"}},[i("van-datetime-picker",{attrs:{type:"datetime","min-date":e.minDate,"show-toolbar":"",title:"请选择截止时间"},on:{confirm:e.onDeadLinePickConfirm,cancel:function(t){e.showMissionDeadLineTimePicker=!1}}})],1)],1)},s=[],r=(i("4662"),i("28a2")),a=(i("ac6a"),i("28a5"),i("96cf"),i("3b8d")),o=(i("7f7f"),i("5d73")),l=i.n(o),c=i("a651"),u=i("f122"),p=(i("7514"),i("c0d6"));function m(e){var t=p["a"].getters.missionRuleList;return t.find(function(t,i,n){return t.typePropertyId===e})}var h=i("f905"),f=i("acc2"),d={name:"CreateMission",components:{ImgCard:h["a"]},data:function(){return{missionId:null,showMissionTypePicker:!1,showPlatformTypePicker:!1,showMissionDeadLineTimePicker:!1,supportPlatformIndex:0,supportPlatformPropertyId:null,missionTypeIndex:0,missionTypePropertyId:null,missionTitle:"",deadLineTime:null,minDate:new Date,price:null,count:null,collapseActiveName:"",missionUrl:"",textVerify:"",remarks:"",sampleImgArray:[],explainSteps:[{}]}},computed:{totalPrice:function(){if(null===this.price||void 0===this.price||null===this.count||void 0===this.count)return null;var e=this.$store.getters.partner,t=e.minFeePrice/100,i=this.count*this.price,n=i*this.$store.getters.partner.feePercent/100;return n<t&&(n=t),(i+n).toFixed(2)},feeText:function(){var e=this.$store.getters.partner,t=e.minFeePrice/100;return 0===t?"服务费：成交额".concat(e.feePercent,"%"):"服务费：成交额".concat(e.feePercent,"% 最低").concat(t,"元")},missionTypes:function(){var e=this.$store.getters.missionRuleList,t=[],i=!0,n=!1,s=void 0;try{for(var r,a=l()(e);!(i=(r=a.next()).done);i=!0){var o=r.value;t.push(this.getPropertyById(o.typePropertyId))}}catch(c){n=!0,s=c}finally{try{i||null==a.return||a.return()}finally{if(n)throw s}}return t},missionTypeTitles:function(){return this.missionTypes.map(function(e){return e.name})},supportPlatforms:function(){return Object(c["c"])(c["a"].DEVICE_TYPE)},platformNames:function(){return this.supportPlatforms.map(function(e){return e.name})},deadLineTimeString:function(){return this.deadLineTime?this.deadLineTime.format():null},missionRule:function(){return this.missionTypePropertyId?m(this.missionTypePropertyId):null},pricePlaceholder:function(){return this.missionRule?"最低出价".concat(this.missionRule.minPrice/100,"元"):""},countPlaceholder:function(){return this.missionRule?"最少".concat(this.missionRule.minCount,"单"):""},sampleImgCount:function(){return this.missionRule?this.missionRule.verifyImgCount:5}},mounted:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t,i,n,s,r,a,o,c,p,m,h,f,d,v,x,g,y,k=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.missionId=this.$route.query.id,!this.missionId){e.next=62;break}return this.showLoading(),e.next=5,this.httpPost(u["t"],{id:this.missionId});case 5:if(t=e.sent,!t.success){e.next=61;break}i=t.data,n=0;case 9:if(!(n<this.missionTypes.length)){e.next=17;break}if(s=this.missionTypes[n],s.id!==i.typePropertyId){e.next=14;break}return this.missionTypeIndex=n,e.abrupt("break",17);case 14:n++,e.next=9;break;case 17:r=0;case 18:if(!(r<this.supportPlatforms.length)){e.next=26;break}if(a=this.supportPlatforms[r],a.id!==i.mobilePropertyId){e.next=23;break}return this.supportPlatformIndex=r,e.abrupt("break",26);case 23:r++,e.next=18;break;case 26:return this.missionTitle=i.title,i.deadlineTime&&(o=i.deadlineTime.split(" "),c=o[0].split("-"),this.deadLineTime=new Date(c[0],c[1]-1,c[2])),this.price=i.price/100,this.count=i.count,this.missionUrl=i.url,this.textVerify=i.textVerify,this.remarks=i.remark,e.next=35,this.httpPost(u["q"],{dataId:this.missionId,type:0});case 35:return p=e.sent,p.success&&p.data.forEach(function(e){k.sampleImgArray.push({content:e.path})}),e.next=39,this.httpPost(u["x"],{id:this.missionId});case 39:if(m=e.sent,!m.success){e.next=61;break}for(this.explainSteps=m.data,h=!0,f=!1,d=void 0,e.prev=45,v=l()(this.explainSteps);!(h=(x=v.next()).done);h=!0)g=x.value,y=g.img,y&&(g.img={content:y});e.next=53;break;case 49:e.prev=49,e.t0=e["catch"](45),f=!0,d=e.t0;case 53:e.prev=53,e.prev=54,h||null==v.return||v.return();case 56:if(e.prev=56,!f){e.next=59;break}throw d;case 59:return e.finish(56);case 60:return e.finish(53);case 61:this.hideLoading();case 62:this.missionTypePropertyId=this.missionTypes[this.missionTypeIndex].id,this.supportPlatformPropertyId=this.supportPlatforms[this.supportPlatformIndex].id;case 64:case"end":return e.stop()}},e,this,[[45,49,53,61],[54,,56,60]])}));function t(){return e.apply(this,arguments)}return t}(),methods:{onNavBarLeftPressed:function(){this.$router.back()},onNavBarRightPressed:function(){},onMissionTypePickConfirm:function(e,t){this.showMissionTypePicker=!1,this.missionTypeIndex=t,this.missionTypePropertyId=this.missionTypes[this.missionTypeIndex].id},onPlatformTypePickConfirm:function(e,t){this.showPlatformTypePicker=!1,this.supportPlatformIndex=t,this.supportPlatformPropertyId=this.supportPlatforms[this.supportPlatformIndex].id},onDeadLinePickConfirm:function(e,t){this.showMissionDeadLineTimePicker=!1,this.deadLineTime=e},onDeadLinePickClick:function(){this.minDate=new Date((new Date).getTime()+9e7),this.showMissionDeadLineTimePicker=!0},onSampleItemClick:function(e){Object(r["a"])({images:Object(f["a"])(this.sampleImgArray),startPosition:e})},onExplainItemClick:function(e){this.explainSteps[e].img&&Object(r["a"])({images:Object(f["a"])([this.explainSteps[e].img]),startPosition:0})},onSampleReadImg:function(e,t){this.sampleImgArray.push(e)},onSampleDeleteImg:function(e){this.sampleImgArray.splice(e,1)},onExplainReadImg:function(e,t){console.log("explainSteps = ",this.explainSteps),console.log("name = ",t);var i=this.explainSteps[t];i.img=e,this.$set(this.explainSteps,t,i)},onExplainDeleteImg:function(e){var t=this.explainSteps[e];t.img=null,this.$set(this.explainSteps,e,t)},onExplainDelete:function(e){1===this.explainSteps.length?this.explainSteps=[{}]:this.explainSteps.splice(e,1)},onAddExplainStepPressed:function(){this.explainSteps.length>=30?this.toastFail("最多30个步骤"):this.explainSteps.push({})},onCreateMissionButtonPressed:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t={typePropertyId:this.missionTypePropertyId,mobilePropertyId:this.supportPlatformPropertyId,title:this.missionTitle,deadlineTime:this.deadLineTimeString,price:100*this.price,count:this.count,url:this.missionUrl,textVerify:this.textVerify,remark:this.remarks},this.missionId&&(t.missionId=this.missionId),this.validData(t)){e.next=4;break}return e.abrupt("return");case 4:this.showLoading(),this.uploadSample(t);case 6:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),uploadSample:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(t){var i,n,s,r,o,c,u,p,m,h,d,v,x,g,y=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:for(i=[],n=!0,s=!1,r=void 0,e.prev=4,o=l()(this.sampleImgArray);!(n=(c=o.next()).done);n=!0)u=c.value,u.file&&i.push(u);e.next=12;break;case 8:e.prev=8,e.t0=e["catch"](4),s=!0,r=e.t0;case 12:e.prev=12,e.prev=13,n||null==o.return||o.return();case 15:if(e.prev=15,!s){e.next=18;break}throw r;case 18:return e.finish(15);case 19:return e.finish(12);case 20:if(0!==i.length){e.next=45;break}for(p=[],m=!0,h=!1,d=void 0,e.prev=25,v=l()(this.sampleImgArray);!(m=(x=v.next()).done);m=!0)g=x.value,p.push(g.content);e.next=33;break;case 29:e.prev=29,e.t1=e["catch"](25),h=!0,d=e.t1;case 33:e.prev=33,e.prev=34,m||null==v.return||v.return();case 36:if(e.prev=36,!h){e.next=39;break}throw d;case 39:return e.finish(36);case 40:return e.finish(33);case 41:t.sampleImgList=p,this.uploadExplain(t),e.next=47;break;case 45:return e.next=47,Object(f["b"])(i,function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(i,n){var s,r,a,o,c,u,p,m,h,f,d,v,x;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:for(t.sampleKey=i,s=[],r=!0,a=!1,o=void 0,e.prev=5,c=l()(y.sampleImgArray);!(r=(u=c.next()).done);r=!0)p=u.value,p.file||s.push(p.content);e.next=13;break;case 9:e.prev=9,e.t0=e["catch"](5),a=!0,o=e.t0;case 13:e.prev=13,e.prev=14,r||null==c.return||c.return();case 16:if(e.prev=16,!a){e.next=19;break}throw o;case 19:return e.finish(16);case 20:return e.finish(13);case 21:for(m=!0,h=!1,f=void 0,e.prev=24,d=l()(n);!(m=(v=d.next()).done);m=!0)x=v.value,s.push(x.fileName);e.next=32;break;case 28:e.prev=28,e.t1=e["catch"](24),h=!0,f=e.t1;case 32:e.prev=32,e.prev=33,m||null==d.return||d.return();case 35:if(e.prev=35,!h){e.next=38;break}throw f;case 38:return e.finish(35);case 39:return e.finish(32);case 40:t.sampleImgList=s,y.uploadExplain(t);case 42:case"end":return e.stop()}},e,null,[[5,9,13,21],[14,,16,20],[24,28,32,40],[33,,35,39]])}));return function(t,i){return e.apply(this,arguments)}}(),function(){y.toastFail("图片上传失败，请重试")});case 47:case"end":return e.stop()}},e,this,[[4,8,12,20],[13,,15,19],[25,29,33,41],[34,,36,40]])}));function t(t){return e.apply(this,arguments)}return t}(),uploadExplain:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(t){var i,n,s,r,o,c,u,p=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:for(i=[],n=!0,s=!1,r=void 0,e.prev=4,o=l()(this.explainSteps);!(n=(c=o.next()).done);n=!0)u=c.value,u.img&&u.img.file&&i.push(u.img);e.next=12;break;case 8:e.prev=8,e.t0=e["catch"](4),s=!0,r=e.t0;case 12:e.prev=12,e.prev=13,n||null==o.return||o.return();case 15:if(e.prev=15,!s){e.next=18;break}throw r;case 18:return e.finish(15);case 19:return e.finish(12);case 20:if(0!==i.length){e.next=25;break}t.explainList=[],this.requestCreateMission(t),e.next=27;break;case 25:return e.next=27,Object(f["b"])(i,function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(i,n){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t.explainKey=i,t.explainList=p.createExplainList(n),p.requestCreateMission(t);case 3:case"end":return e.stop()}},e)}));return function(t,i){return e.apply(this,arguments)}}(),function(){p.toastFail("图片上传失败，请重试")});case 27:case"end":return e.stop()}},e,this,[[4,8,12,20],[13,,15,19]])}));function t(t){return e.apply(this,arguments)}return t}(),createExplainList:function(e){var t=[],i=0,n=!0,s=!1,r=void 0;try{for(var a,o=l()(this.explainSteps);!(n=(a=o.next()).done);n=!0){var c=a.value,u={};c.text&&(u.text=c.text),c.img&&(c.img.file?(u.img=e[i].fileName,i++):u.img=c.img.content),(u.text||u.img)&&t.push(u)}}catch(p){s=!0,r=p}finally{try{n||null==o.return||o.return()}finally{if(s)throw r}}return t},requestCreateMission:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(t){var i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.httpPostWithLoading(u["i"],t);case 2:i=e.sent,i.success&&(this.$store.commit("updateUser",i.data),this.toastSuccess("创建成功"),this.$router.back());case 4:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),validData:function(e){var t=e.deadlineTime;if(!t)return this.toastFail("请选择截止时间"),!1;var i=e.title;if(0===i.length||!i)return this.toastFail("请输入标题"),!1;if(i.length>12)return this.toastFail("标题过长"),!1;var n=/^[0-9]+$/,s=e.price;if(!s)return this.toastFail("请输入出价"),!1;if(s<this.missionRule.minPrice)return this.toastFail("最低出价为".concat(this.missionRule.minPrice/100,"元")),!1;if(s!==100*this.price)return this.toastFail("请输入正确的出价"),!1;var r=e.count;if(!r)return this.toastFail("请输入数量"),!1;if(!n.test(r))return this.toastFail("数量需为整数"),!1;if(r<this.missionRule.minCount)return this.toastFail("最低数量为".concat(this.missionRule.minCount)),!1;if(100*this.totalPrice>this.$store.getters.user.missionCoin)return this.toastFail("任务币余额不足"),!1;if(!this.sampleImgArray||0===this.sampleImgArray.length)return this.toastFail("请添加审核图样"),!1;var a=e.url;if(a.length>500)return this.toastFail("链接过长"),!1;var o=e.textVerify;if(o.length>500)return this.toastFail("文字验证过长"),!1;var l=e.remark;if(l.length>200)return this.toastFail("备注过长"),!1;if(this.explainSteps.length>1)for(var c=0;c<this.explainSteps.length;c++){var u=this.explainSteps[c];if(!u.text&&!u.img)return this.toastShortMsg("请输入第".concat(c+1,"步的步骤说明或者说明图片")),!1}return!0}}},v=d,x=(i("fceb"),i("2877")),g=Object(x["a"])(v,n,s,!1,null,"121f84a7",null);t["default"]=g.exports},"76a7":function(e,t,i){},ac6a:function(e,t,i){for(var n=i("cadf"),s=i("0d58"),r=i("2aba"),a=i("7726"),o=i("32e9"),l=i("84f2"),c=i("2b4c"),u=c("iterator"),p=c("toStringTag"),m=l.Array,h={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},f=s(h),d=0;d<f.length;d++){var v,x=f[d],g=h[x],y=a[x],k=y&&y.prototype;if(k&&(k[u]||o(k,u,m),k[p]||o(k,p,x),l[x]=m,g))for(v in n)k[v]||r(k,v,n[v],!0)}},fceb:function(e,t,i){"use strict";var n=i("76a7"),s=i.n(n);s.a}}]);